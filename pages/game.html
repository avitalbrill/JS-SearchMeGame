<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../style/styleProject.css" />
    <title>Game</title>
  </head>
  <body>
    <!-- 转爪转 拽 专拽注 砖转 驻  专 -->
    <audio
      id="backgroundMusic"
      src="../images/Happy and Fun Pop Background Music For Videos.mp3"
      autoplay
      loop
    ></audio>

    <div id="all">
      <div id="head">
        <div id="containtimer">
          <div id="score">
            <!-- 转爪转 拽 -->
            <h1 id="h1">score:</h1>
            <h1 id="grade">0</h1>
          </div>
          <div class="timer animatable">
            <svg>
              <!-- 注 注专 专 -->
              <circle cx="50%" cy="50%" r="90" />
              <circle cx="50%" cy="50%" r="90" pathLength="1" />
              <text x="100" y="100" text-anchor="middle">
                <tspan id="timeLeft"></tspan>
              </text>
              <text x="100" y="120" text-anchor="middle" id="second">
                seconds
              </text>
            </svg>
          </div>
        </div>
        <div id="rand"></div>
        <div id="star">
          <!-- 转转 砖  砖爪转 转 专转 拽砖 -->
          <img src="../images/star.png" id="star1" />
          <img src="../images/star.png" id="star2" />
          <img src="../images/star.png" id="star3" />
        </div>
      </div>
      <div id="board"></div>
      <div id="timer"></div>
      <div id="results">
        <!-- 驻转专 转转 砖拽 砖 -->
        <button onclick="Again()">Play Again</button>
      </div>
    </div>

    <script>
      //  注转 祝 驻注 转 拽 专拽注
      window.addEventListener("DOMContentLoaded", function () {
        var audio = document.getElementById("backgroundMusic");
        audio.play();
      });

      // 专 转  砖拽 转转
      let timeLeft = 60;
      let timer = document.getElementById("timeLeft");

      // 驻拽爪 砖拽转  砖专 
      function isTimeLeft() {
        return timeLeft > -1;
      }

      // 驻拽爪 砖驻注 转 专
      function runTimer(timerElement) {
        const timerCircle = timerElement.querySelector("svg > circle + circle");
        timerElement.classList.add("animatable");
        timerCircle.style.strokeDashoffset = 1;

        // 驻注 专 砖专抓  砖
        let countdownTimer = setInterval(function () {
          if (isTimeLeft()) {
            // 注 转  转专 转 注 砖 专
            const timeRemaining = timeLeft--;
            const normalizedTime = (60 - timeRemaining) / 60;

            timerCircle.style.strokeDashoffset = normalizedTime;
            timer.innerHTML = timeRemaining;
          } else {
            // 注爪专 转 专 砖 专
            clearInterval(countdownTimer);
            timerElement.classList.remove("animatable");
          }
        }, 1000);
      }

      // 驻注 转 专
      runTimer(document.querySelector(".timer"));

      // 专 砖转 转转 砖拽
      let c = 0,
        cnt = 0,
        k = 4;

      // 转 转 砖拽
      start(k);

      // 驻拽爪 专砖转 砖转 转 砖拽
      function start(k) {
        // 爪专 住驻专 拽专 驻砖
        let randNum = Math.floor(Math.random() * (k * 10)) + 1;
        document.getElementById("rand").innerHTML = randNum;

        // 爪专 拽 拽专 住驻专 拽砖
        let r1 = Math.floor(Math.random() * k) + 1;
        let r2 = Math.floor(Math.random() * k) + 1;
        let numid;
        let board = document.getElementById("board");

        // 爪专 转  砖拽
        for (let i = k; i >= 1; i--) {
          let newRow = document.createElement("div");
          newRow.classList.add("row");
          board.appendChild(newRow);

          for (let j = k; j >= 1; j--) {
            let numbers = i * k - j + 1;
            let span = document.createElement("span");
            // 住祝 拽 转  
            if (k == 4) span.classList.add("square");
            if (k == 6) span.classList.add("square2");
            if (k == 8) span.classList.add("square3");

            span.setAttribute("id", "a" + numbers);
            newRow.appendChild(span);

            // 转 转   8x8
            if (k == 8) {
              document.getElementById("a" + numbers).style.fontSize = "2rem";
              document.getElementById("a" + numbers).style.width = "6vw";
              document.getElementById("a" + numbers).style.height = "7vh";
            }

            // 爪专 住驻专 拽专 
            randNumbers = Math.floor(Math.random() * (k * 10)) + 1;
            while (randNumbers == randNum) {
              randNumbers = Math.floor(Math.random() * (k * 10)) + 1;
            }
            span.textContent = randNumbers;
            // 爪 转 住驻专 拽砖 拽 拽专 砖专
            if (i == r1 && j == r2) {
              span.textContent = randNum;
              numid = numbers;
              console.log(numid);
            }

            let num = i * k - j + 1;
            // 住祝  爪  专注
            document
              .getElementById("a" + num)
              .addEventListener("click", check2);
            function check2() {
              document.getElementById("a" + num).textContent = "";
            }
          }
        }
        let x;
        // 拽 转 砖 砖拽 住 拽
        let y = localStorage.getItem("name");
        //  砖 砖 砖专, 爪 转
        if (y) {
          document.getElementById("h1").innerHTML = y;
         }  else {
          //   砖 砖专, 爪 砖 专专转   转专
         document.getElementById("h1").innerHTML = "Player";
         }

        document.getElementById("h1").innerHTML = y;

        // 住祝  爪 住驻专 拽砖
        document.getElementById("a" + numid).addEventListener("click", check);

        // 驻拽爪 砖转爪注转 砖专 砖拽 抓 注 住驻专 
        function check() {
          x = document.getElementById("grade");

          x.setAttribute("class", "grade");
          // 注 转 拽
          cnt += 100;

          document.getElementById("grade").innerHTML = "+" + cnt;
          document.getElementById("board").innerHTML = "";

          // 注 转 专转 拽砖 砖注 拽 住
          if (cnt == 300) {
            k = 6;
            x.classList.remove("grade");
            document.getElementById("star1").src = "../images/star_477406.png";
          }
          if (cnt == 600) {
            x.classList.remove("grade");
            k = 8;
            document.getElementById("star2").src = "../images/star_477406.png";
          }

          // 住 转 砖拽 砖注 拽 拽住
          if (cnt == 900) {
            x.classList.remove("grade");
            document.getElementById("star3").src = "../images/star_477406.png";
            k = 0;
            document.getElementById("rand").innerHTML = " ";
            const myTimeout = setTimeout(win, 1000);
          }

          // 转 住 砖
          start(k);

          // 砖专 转 砖 住 拽
          localStorage.setItem(
            "record",
            document.getElementById("grade").innerHTML
          );
          // 驻拽爪 砖注专 住 爪
          function win() {
            window.location.href = "../pages/win.html";

            clearTimeout(myTimeout);
          }
        }
      }

      // 驻拽爪 砖转 砖拽 砖
      function Again() {
        window.location.href = "../pages/game.html";
      }
    </script>
  </body>
</html>
